# safelist
branches:
  only:
  - master
  - /^feature\/.*$/
language: node_js
node_js:
  - "4.4.5"
services:
  - mongodb
before_script:
  - TZ=America/Chicago
  - date
  - npm install -g gulp
  - "cp .env.example .env.api"
  - sleep 10
script:
  - "gulp test"
after_success:
  # CREATE GIT TAG
  - git config --global user.email "builds@travis-ci.com"
  - git config --global user.name "Travis CI"
  - export GIT_TAG=build-$TRAVIS_BRANCH-$(date -u "+%Y-%m-%d")-$TRAVIS_BUILD_NUMBER
  - echo -n $GIT_TAG > public/version
  - git commit -m "Set build VERSION number" public/version
  - git tag $GIT_TAG -a -m "Generated tag from TravisCI build $TRAVIS_BUILD_NUMBER"
  - git push --quiet https://$GITHUBKEY@github.com/noinarisak/carecenter-api $GIT_TAG > /dev/null 2>&1
notifications:
  slack: carecenter-nonprofit:kYlXXtv0DOrnIVZhkNzKevsN